观测数据的准备
==========================

.. contents ::

常规站点观测的准备
-------------------------

我们利用质控程序生成 `PrepBUFR` 格式的观测资料， 请参见 `ObsProc Documentation <https://obsprocdoc.readthedocs.io/en/latest/#>`_


站点降水观测数据转换成 `Grib` 格式的格点降水观测数据
------------------------------------------------------------

客户提供的站点降水观测数据往往都是 `csv` 文本格式，如下：

.. code-block:: bash

    站号,经度,纬度,海拔高度,站点级别,观测值,站名
    768010,119.37,41.94,536,9999,9.1,
    696328,121.87,45.86,300,9999,1.2,
    768008,119.5,42.05,555,9999,1,
    772104,118.66,33.5,19,9999,0.1,
    663566,117.79,41.53,698,9999,0.1,
    57349,109.87,31.08,606.8,9999,0.1,巫山
    768014,120.85,41.91,185,9999,1.5,
    768013,121.08,41.91,204,9999,0.3,
    696322,121.99,45.58,279,9999,0.2,
    768003,119.74,42.16,583,9999,0.6,
    768002,120.81,42.19,324,9999,0.1,
    768001,119.47,42.32,463,9999,0.2,
    696321,122.09,45.61,252,9999,0.6,
    768007,120.9,42.08,239,9999,0.8,
    768005,120.97,42.13,237,9999,0.5,
    725017,131.39,46.71,101,9999,10.7,
    776216,118.26,33.97,27,9999,0.1,
    663582,116.9,41.87,1140,9999,0.3,
    663583,116.98,42.02,1130,9999,0.1,
    725022,132.24,46.48,78.8,9999,30.1,
    663581,117.13,41.83,1217,9999,0.1,
    694301,124.14,43.59,145.5,9999,0.1,
    686098,115.85,36.75,34.5,9999,0.1,
    768017,119.31,41.79,519,9999,0.2,
    686097,115.92,36.86,32,9999,0.4,
    768022,119.88,41.78,615,9999,0.7,
    661524,115.2,38.45,73.4,9999,0.1,
    768021,119.46,41.79,554,9999,0.7,
    768020,121.05,41.81,225,9999,3,
    663592,117.8,40.97,411,9999,0.1,
    57381,113.34,31.62,106.5,9999,0.1,随州

而MET的MODE检验需要 `NetCDF` 或 `Grib/Grib2` 格式的格点降水观测数据，我们利用欧洲中心的 :code:`eccodes` 发展了一个简单的转换程序，其基本流程是：

1. 准备一个东亚地区的 `Grib` 格式的降水观测模板；

    .. figure:: images/st4.EastAsia.template.png
       :scale: 50%
       :align: center
       :alt: 东亚地区的 `Grib` 格式的降水观测模板

       东亚地区的 `Grib` 格式的降水观测模板

#. 将站点观测经过处理，插值到规则格点上：

    .. figure:: images/st4_analyzed.png
       :scale: 50%
       :align: center
       :alt: 东亚地区的 `Grib` 格式的降水观测分析

       东亚地区的 `Grib` 格式的降水观测分析